<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D&D Encounter Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=MedievalSharp&display=swap" rel="stylesheet">
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background-color: #1e1c1a;
  color: #f5e6c8;
  font-family: 'Georgia', serif;
}

.container {
  width: 95%;
  max-width: 1200px;
  margin: 10px auto;
  background: #2d2723;
  padding: 15px;
  border-radius: 15px;
  box-shadow: 0 0 20px #000000aa;
  border: 3px solid #b08d57;
}

h1, h2 {
  font-family: 'Cinzel', serif;
  text-align: center;
  color: #f0d67c;
  text-shadow: 2px 2px 4px #000;
  margin: 10px 0;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  table-layout: fixed;
  background: #3b322d;
  color: #f5e6c8;
  border: 2px solid #b08d57;
  box-shadow: inset 0 0 5px #000;
}

th, td {
  border: 1px solid #b08d57;
  padding: 6px 4px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

th {
  background: linear-gradient(to bottom, #5b473a, #3b322d);
  color: #f0d67c;
  font-family: 'MedievalSharp', cursive;
  text-shadow: 1px 1px 2px #000;
}

td input {
  width: 60px;
  box-sizing: border-box;
  text-align: center;
}

td button {
  display: block;
  width: 80%;
  margin: 2px auto;
  background: #8b5e3c;
  color: #f5e6c8;
  border: 1px solid #b08d57;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

td button:hover {
  background: #b08d57;
  color: #3b322d;
}

select, input {
  background: #5b473a;
  color: #f5e6c8;
  border: 1px solid #b08d57;
  border-radius: 4px;
  padding: 4px;
}

.dice {
  text-align: center;
  margin-bottom: 15px;
}

.dice button {
  background: #8b5e3c;
  color: #f5e6c8;
  border: 1px solid #b08d57;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.dice button:hover {
  background: #b08d57;
  color: #3b322d;
}

.d20 {
  font-family: 'MedievalSharp', cursive;
  display: inline-block;
  background: #8b5e3c;
  color: #f5e6c8;
  padding: 6px 12px;
  border-radius: 50%;
  border: 2px solid #b08d57;
  margin-right: 6px;
  text-shadow: 1px 1px 2px #000;
}

/* --- Timer Styles --- */
#timers {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 15px;
}

.timer {
  background: #3b322d;
  border: 2px solid #b08d57;
  border-radius: 10px;
  padding: 8px;
  display: flex;
  align-items: center;
  justify-content: space-around;
  box-shadow: inset 0 0 5px #000;
}

.timer label {
  font-family: 'MedievalSharp', cursive;
  color: #f0d67c;
}

.timer input {
  width: 50px;
  text-align: center;
}

.timer button {
  background: #8b5e3c;
  color: #f5e6c8;
  border: 1px solid #b08d57;
  border-radius: 5px;
  padding: 4px 8px;
  cursor: pointer;
}

.timer button:hover {
  background: #b08d57;
  color: #3b322d;
}

.timer span {
  font-family: 'Cinzel', serif;
  font-size: 1.2em;
  color: #f0d67c;
  text-shadow: 1px 1px 2px #000;
  width: 90px;
  text-align: center;
}

.timer.done {
  color: #ff4444;
  font-weight: bold;
  animation: flash 1s infinite alternate;
}

@keyframes flash {
  0% { color: #ff4444; }
  100% { color: #f0d67c; }
}
</style>
</head>
<body>
<div class="container">
<h1>üó°Ô∏è D&D Encounter Dashboard üõ°Ô∏è</h1>

<h2>Players</h2>
<select id="playerSelect"></select>
<button id="addPlayerBtn">Add Player</button>
<table id="playerTable">
  <thead>
    <tr>
      <th>Name</th><th>HP</th><th>AC</th><th>Attack</th><th>Current HP</th>
      <th>Minor 1</th><th>Minor 2</th>
      <th>Major 1</th><th>Major 2</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Enemies</h2>
<select id="enemySelect"></select>
<button id="addEnemyBtn">Add Enemy</button>
<table id="enemyTable">
  <thead>
    <tr>
      <th>Name</th><th>HP</th><th>AC</th><th>Attack</th><th>Current HP</th>
      <th>Minor 1</th><th>Minor 2</th>
      <th>Major 1</th><th>Major 2</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Dice Roller</h2>
<div class="dice">
  <span class="d20">üé≤</span>
  <label>Dice: 
    <select id="diceType">
      <option value="6">D6</option>
      <option value="8">D8</option>
      <option value="10">D10</option>
      <option value="12">D12</option>
      <option value="20">D20</option>
    </select>
  </label>
  <button id="rollDiceBtn">Roll</button>
  <span id="diceResult"></span>
</div>

<h2>Timers</h2>
<div id="timers">
  <div class="timer">
    <label>Timer 1:</label>
    <input type="number" id="t1Minutes" placeholder="min" min="0" value="0">
    <input type="number" id="t1Seconds" placeholder="sec" min="0" max="59" value="0">
    <button onclick="startTimer(1)">Start</button>
    <button onclick="pauseTimer(1)">Pause</button>
    <button onclick="resetTimer(1)">Reset</button>
    <span id="timerDisplay1">00:00</span>
  </div>

  <div class="timer">
    <label>Timer 2:</label>
    <input type="number" id="t2Minutes" placeholder="min" min="0" value="0">
    <input type="number" id="t2Seconds" placeholder="sec" min="0" max="59" value="0">
    <button onclick="startTimer(2)">Start</button>
    <button onclick="pauseTimer(2)">Pause</button>
    <button onclick="resetTimer(2)">Reset</button>
    <span id="timerDisplay2">00:00</span>
  </div>

  <div class="timer">
    <label>Timer 3:</label>
    <input type="number" id="t3Minutes" placeholder="min" min="0" value="0">
    <input type="number" id="t3Seconds" placeholder="sec" min="0" max="59" value="0">
    <button onclick="startTimer(3)">Start</button>
    <button onclick="pauseTimer(3)">Pause</button>
    <button onclick="resetTimer(3)">Reset</button>
    <span id="timerDisplay3">00:00</span>
  </div>
</div>
</div>

<script>
// --- Entities ---
const playersList = [
  {name:'Curtis Johnson', hp:5, ac:14, attack:4},
  {name:'Millie Johnson', hp:5, ac:12, attack:3},
  {name:'Felcity Weatherhead', hp:5, ac:12, attack:3},
  {name:'Jesscia Weatherhead', hp:5, ac:12, attack:3}
];
const monstersList = [
  {name:'Rat', hp:2, ac:10, attack:1},
  {name:'Giant Rat', hp:3, ac:10, attack:1},
  {name:'King Rat', hp:2, ac:10, attack:1},
  {name:'Goblin', hp:5, ac:12, attack:2},
  {name:'Skeleton', hp:4, ac:13, attack:3}
];
const minorInjuries = ["Scratched","Bruised","Fatigued","Minor Cut","Sprain"];
const majorInjuries = ["Crippled Arm L","Crippled Arm R","Blinded Eye","Crippled Leg L","Crippled Leg R","Crushed Chest"];

// --- Load/save ---
let players = JSON.parse(localStorage.getItem('players')||'[]');
let enemies = JSON.parse(localStorage.getItem('enemies')||'[]');
function saveData(){ 
  localStorage.setItem('players',JSON.stringify(players)); 
  localStorage.setItem('enemies',JSON.stringify(enemies)); 
}

// --- Populate selects ---
function populateSelects(){
  const pSelect=document.getElementById('playerSelect'); pSelect.innerHTML='';
  playersList.forEach((p,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=p.name; pSelect.appendChild(opt); });
  const eSelect=document.getElementById('enemySelect'); eSelect.innerHTML='';
  monstersList.forEach((m,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=m.name; eSelect.appendChild(opt); });
}

// --- Render ---
function renderTable(){
  function createInjuryCell(entity,type,slot){
    const td=document.createElement('td'); td.textContent=entity[type][slot]||'';
    const btn=document.createElement('button');
    btn.textContent=entity[type][slot]?'Remove':'Add';
    btn.addEventListener('click',()=>{
      if(entity[type][slot]) entity[type][slot]='';
      else entity[type][slot]=(type==='minor'?minorInjuries:majorInjuries)[Math.floor(Math.random()*(type==='minor'?minorInjuries.length:majorInjuries.length))];
      saveData(); renderTable();
    });
    td.appendChild(btn); return td;
  }

  const playerTbody=document.querySelector('#playerTable tbody'); playerTbody.innerHTML='';
  players.forEach((p,i)=>{
    const row=document.createElement('tr');
    ['name','hp','ac','attack'].forEach(k=>{ const td=document.createElement('td'); td.textContent=p[k]; row.appendChild(td); });
    const hpTd=document.createElement('td'); const hpInput=document.createElement('input'); hpInput.type='number'; hpInput.value=p.currentHp; hpInput.addEventListener('change',()=>{p.currentHp=parseInt(hpInput.value)||0;saveData();}); hpTd.appendChild(hpInput); row.appendChild(hpTd);
    for(let j=0;j<2;j++) row.appendChild(createInjuryCell(p,'minor',j));
    for(let j=0;j<2;j++) row.appendChild(createInjuryCell(p,'major',j));
    const actTd=document.createElement('td'); const remBtn=document.createElement('button'); remBtn.textContent='Remove'; remBtn.addEventListener('click',()=>{players.splice(i,1);saveData();renderTable();}); actTd.appendChild(remBtn); row.appendChild(actTd);
    playerTbody.appendChild(row);
  });

  const enemyTbody=document.querySelector('#enemyTable tbody'); enemyTbody.innerHTML='';
  enemies.forEach((e,i)=>{
    const row=document.createElement('tr');
    ['name','hp','ac','attack'].forEach(k=>{ const td=document.createElement('td'); td.textContent=e[k]; row.appendChild(td); });
    const hpTd=document.createElement('td'); const hpInput=document.createElement('input'); hpInput.type='number'; hpInput.value=e.currentHp; hpInput.addEventListener('change',()=>{e.currentHp=parseInt(hpInput.value)||0;saveData();}); hpTd.appendChild(hpInput); row.appendChild(hpTd);
    for(let j=0;j<2;j++) row.appendChild(createInjuryCell(e,'minor',j));
    for(let j=0;j<2;j++) row.appendChild(createInjuryCell(e,'major',j));
    const actTd=document.createElement('td'); const remBtn=document.createElement('button'); remBtn.textContent='Remove'; remBtn.addEventListener('click',()=>{enemies.splice(i,1);saveData();renderTable();}); actTd.appendChild(remBtn); row.appendChild(actTd);
    enemyTbody.appendChild(row);
  });
}

// --- Add ---
document.getElementById('addPlayerBtn').addEventListener('click',()=>{
  const idx=parseInt(document.getElementById('playerSelect').value); const t=playersList[idx];
  players.push({...t,currentHp:t.hp,minor:['',''],major:['','']}); saveData(); renderTable();
});
document.getElementById('addEnemyBtn').addEventListener('click',()=>{
  const idx=parseInt(document.getElementById('enemySelect').value); const t=monstersList[idx];
  enemies.push({...t,currentHp:t.hp,minor:['',''],major:['','']}); saveData(); renderTable();
});

// --- Dice Roller ---
document.getElementById('rollDiceBtn').addEventListener('click',()=>{
  const sides=parseInt(document.getElementById('diceType').value);
  const resultElem=document.getElementById('diceResult');
  resultElem.textContent="Rolling...";
  setTimeout(()=>{
    const roll=Math.floor(Math.random()*sides)+1;
    resultElem.textContent=`üé≤ Result: ${roll}`;
  },400);
});

// --- Timers ---
let timers = [null, null, null];
let endTimes = [null, null, null]; // store future timestamps
let remainingTimes = [0, 0, 0];    // used for pause/resume
let isRunning = [false, false, false];

function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateDisplay(num, remaining) {
  const display = document.getElementById(`timerDisplay${num}`);
  display.textContent = formatTime(remaining);
  display.classList.remove('done');
}

function startTimer(num) {
  if (isRunning[num - 1]) return;

  const min = parseInt(document.getElementById(`t${num}Minutes`).value) || 0;
  const sec = parseInt(document.getElementById(`t${num}Seconds`).value) || 0;
  const now = Date.now();

  if (!endTimes[num - 1]) {
    endTimes[num - 1] = now + (min * 60 + sec) * 1000;
  }

  isRunning[num - 1] = true;
  timers[num - 1] = setInterval(() => {
    const remaining = Math.max(0, Math.round((endTimes[num - 1] - Date.now()) / 1000));
    updateDisplay(num, remaining);
    if (remaining <= 0) {
      clearInterval(timers[num - 1]);
      isRunning[num - 1] = false;
      endTimes[num - 1] = null;
      const display = document.getElementById(`timerDisplay${num}`);
      display.textContent = "‚è∞ TIME!";
      display.classList.add('done');
    }
  }, 1000);
  saveTimers();
}

function pauseTimer(num) {
  if (!isRunning[num - 1]) return;
  clearInterval(timers[num - 1]);
  isRunning[num - 1] = false;

  const remaining = Math.max(0, Math.round((endTimes[num - 1] - Date.now()) / 1000));
  endTimes[num - 1] = null;
  remainingTimes[num - 1] = remaining;
  updateDisplay(num, remaining);
  saveTimers();
}

function resetTimer(num) {
  clearInterval(timers[num - 1]);
  isRunning[num - 1] = false;
  remainingTimes[num - 1] = 0;
  endTimes[num - 1] = null;
  updateDisplay(num, 0);
  saveTimers();
}

// --- Persist timers to localStorage ---
function saveTimers() {
  localStorage.setItem('endTimes', JSON.stringify(endTimes));
}

function loadTimers() {
  const saved = JSON.parse(localStorage.getItem('endTimes') || '[null,null,null]');
  const now = Date.now();
  saved.forEach((t, i) => {
    if (t && t > now) {
      endTimes[i] = t;
      startTimer(i + 1);
    }
  });
}

// --- Init ---
populateSelects();
renderTable();
loadTimers();
</script>







